import semver from 'semver';
import { packagePrefix } from '@conventional-changelog/git-client';
import { bumpDefaultOptions, Project } from './project.js';
export * from './monorepo.types.js';
export class MonorepoProject extends Project {
    /**
     * The mode of the monorepo.
     * If mode is 'fixed', all projects will be bumped to the same version.
     * If mode is 'independent', each project will be bumped to its own version.
     */
    mode;
    projectsMutex;
    /**
     * Creates a new instance of the monorepo project.
     * @param options - The options to use for the monorepo project.
     */
    constructor(options) {
        const { mode, compose } = options;
        super({
            ...options,
            compose: compose
                ? (manifest, isRoot = true) => compose(manifest, isRoot)
                : manifest => manifest
        });
        this.mode = mode;
    }
    /**
     * Get the projects in the monorepo.
     * @yields The projects in the monorepo.
     */
    async *getProjects() {
        if (!this.projectsMutex) {
            const { compose, getProjects } = this.options;
            const options = {
                compose: (manifest) => compose(manifest, false),
                gitClient: this.gitClient,
                manifest: this.manifest
            };
            const projects = [];
            let resolve;
            this.projectsMutex = new Promise((r) => {
                resolve = r;
            });
            for await (const project of getProjects(options)) {
                const isPrivate = await project.manifest.isPrivate();
                if (!isPrivate) {
                    projects.push(project);
                    yield project;
                }
            }
            resolve(projects);
            return;
        }
        yield* await this.projectsMutex;
    }
    /**
     * Get scope from project name.
     * @param name - The name of the project.
     * @returns The scope of the project.
     */
    async getScope(name) {
        if (this.options.scope) {
            return await this.options.scope(name, await this.manifest.getName());
        }
        return name.replace(/@[^/]+\//, '');
    }
    /**
     * Get tag prefix from scope.
     * @param scope - The scope of the project.
     * @returns The tag prefix for the project.
     */
    async getTagPrefix(scope) {
        if (this.options.tagPrefix) {
            return await this.options.tagPrefix(scope);
        }
        if (this.mode === 'fixed') {
            return '';
        }
        return packagePrefix(scope);
    }
    getIndependentCommitMessage() {
        const { versionUpdates } = this;
        if (versionUpdates.length === 0) {
            throw new Error('Nothing to commit');
        }
        return `chore(release): monorepo release\n\n${versionUpdates
            .map(({ name, to }) => `- ${name}@${to}`)
            .join('\n')}`;
    }
    getCommitMessage() {
        const { mode } = this;
        if (mode === 'fixed') {
            return super.getCommitMessage();
        }
        return this.getIndependentCommitMessage();
    }
    async getIndependentTags() {
        const tags = [];
        for await (const project of this.getProjects()) {
            const { manifest } = project;
            const name = await manifest.getName();
            const scope = await this.getScope(name);
            const tagPrefix = await this.getTagPrefix(scope);
            tags.push(...await project.getTags({
                tagPrefix
            }));
        }
        return tags;
    }
    async getTags() {
        const { mode } = this;
        if (mode === 'fixed') {
            return super.getTags();
        }
        return this.getIndependentTags();
    }
    async getIndependentReleaseData() {
        const data = [];
        for await (const project of this.getProjects()) {
            const { manifest } = project;
            const name = await manifest.getName();
            const scope = await this.getScope(name);
            const tagPrefix = await this.getTagPrefix(scope);
            const releaseData = await project.getReleaseData({
                tagPrefix
            });
            data.push(...releaseData.map(data => ({
                ...data,
                title: `${name}: ${data.title}`
            })));
        }
        return data;
    }
    async getReleaseData() {
        const { mode } = this;
        if (mode === 'fixed') {
            return super.getReleaseData();
        }
        return this.getIndependentReleaseData();
    }
    async getBumpOptions(project, options, baseVersion) {
        const { preset = bumpDefaultOptions.preset, extraScopes = [], byProject, ...bumpOptions } = options;
        const { manifest } = project;
        const name = await manifest.getName();
        const scope = await this.getScope(name);
        const tagPrefix = await this.getTagPrefix(scope);
        const projectPreset = {
            ...typeof preset === 'string'
                ? {
                    name: preset
                }
                : preset,
            scope: [scope, ...extraScopes]
        };
        const projectBumpOptions = {
            ...bumpOptions,
            ...byProject?.[name],
            preset: projectPreset,
            tagPrefix,
            baseVersion
        };
        return projectBumpOptions;
    }
    getNextVersion(options = {}) {
        if (this.mode === 'fixed' && options.version) {
            return super.getNextVersion(options);
        }
        throw new Error('Monorepo project does not support getNextVersion');
    }
    async independentBump(options = {}) {
        let hasBump = false;
        for await (const project of this.getProjects()) {
            const projectBumpOptions = await this.getBumpOptions(project, options);
            hasBump = await project.bump(projectBumpOptions) || hasBump;
            this.changedFiles.push(...project.changedFiles);
            this.versionUpdates.push(...project.versionUpdates);
        }
        return hasBump;
    }
    async fixedBump(options = {}) {
        const { force } = options;
        const updatedProjects = [];
        const baseVersion = await this.manifest.getVersion();
        let hasBump = false;
        let fixedVersion;
        for await (const project of this.getProjects()) {
            const projectBumpOptions = await this.getBumpOptions(project, options, baseVersion);
            const version = await project.getNextVersion(projectBumpOptions);
            if (version || force) {
                updatedProjects.push({
                    project,
                    options: projectBumpOptions
                });
                if (version && (!fixedVersion || semver.gt(version, fixedVersion))) {
                    fixedVersion = version;
                }
            }
        }
        if (fixedVersion) {
            hasBump = await super.bump({
                ...options,
                forcePrivate: true,
                version: fixedVersion,
                tagPrefix: await this.getTagPrefix('')
            });
            for (const { project, options } of updatedProjects) {
                hasBump = await project.bump({
                    ...options,
                    version: fixedVersion
                }) || hasBump;
                this.changedFiles.push(...project.changedFiles);
                this.versionUpdates.push(...project.versionUpdates);
            }
        }
        return hasBump;
    }
    async bump(options = {}) {
        const { mode } = this;
        if (mode === 'fixed') {
            return this.fixedBump(options);
        }
        return this.independentBump(options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ub3JlcG8uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcHJvamVjdC9tb25vcmVwby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUE7QUFDM0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9DQUFvQyxDQUFBO0FBR2xFLE9BQU8sRUFFTCxrQkFBa0IsRUFDbEIsT0FBTyxFQUNSLE1BQU0sY0FBYyxDQUFBO0FBT3JCLGNBQWMscUJBQXFCLENBQUE7QUFFbkMsTUFBTSxPQUFnQixlQUFnQixTQUFRLE9BQU87SUFDbkQ7Ozs7T0FJRztJQUNILElBQUksQ0FBYztJQUVWLGFBQWEsQ0FBZ0M7SUFFckQ7OztPQUdHO0lBQ0gsWUFBWSxPQUErQjtRQUN6QyxNQUFNLEVBQ0osSUFBSSxFQUNKLE9BQU8sRUFDUixHQUFHLE9BQU8sQ0FBQTtRQUVYLEtBQUssQ0FBQztZQUNKLEdBQUcsT0FBTztZQUNWLE9BQU8sRUFBRSxPQUFPO2dCQUNkLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxNQUFNLEdBQUcsSUFBSSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQztnQkFDeEQsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUTtTQUN6QixDQUFDLENBQUE7UUFFRixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTtJQUNsQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFBLENBQUUsV0FBVztRQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ3hCLE1BQU0sRUFDSixPQUFPLEVBQ1AsV0FBVyxFQUNaLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQTtZQUNoQixNQUFNLE9BQU8sR0FBRztnQkFDZCxPQUFPLEVBQUUsQ0FBQyxRQUF5QixFQUFFLEVBQUUsQ0FBQyxPQUFRLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FB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