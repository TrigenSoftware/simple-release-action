import { Logger } from './logger.js';
export * from './releaser.types.js';
/**
 * A releaser class that provides methods to manage the release process of a project.
 */
export class Releaser {
    options;
    /**
     * Target project to release.
     */
    project;
    /**
     * Git repository hosting service to use for creating releases and pull requests.
     */
    hosting;
    /**
     * The git client used to interact with the repository.
     */
    gitClient;
    /**
     * The logger used to log messages during the release process.
     */
    logger;
    state = {};
    stepsOptions = {};
    queue = [];
    /**
     * Creates a project releaser.
     * @param options
     */
    constructor(options) {
        this.options = options;
        const { project, hosting } = options;
        this.project = project;
        this.hosting = hosting;
        this.gitClient = project.gitClient;
        this.logger = options.logger ?? new Logger(options);
    }
    enqueue(fn) {
        this.queue.push(fn);
        return this;
    }
    async getBaseBranch() {
        const { baseBranch } = this.state;
        if (baseBranch) {
            return baseBranch;
        }
        return await this.project.gitClient.getCurrentBranch();
    }
    /**
     * Set default options for the releaser steps.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    setOptions(options) {
        const { logger } = this;
        logger.verbose('set-options', 'Setting options for steps:');
        logger.verbose('set-options', options);
        for (const [key, value] of Object.entries(options)) {
            Object.assign(this.stepsOptions[key] ??= {}, value);
        }
        logger.verbose('set-options', 'Final options for steps:');
        logger.verbose('set-options', this.stepsOptions);
        return this;
    }
    /**
     * Enqueue a task to checkout a branch.
     * @param branch - The branch to checkout, defaults to `'simple-release'`.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    checkout(branch, options = {}) {
        return this.enqueue(async () => {
            const { logger, gitClient } = this;
            const { dryRun } = this.options;
            const { branch: headBranch = 'simple-release', username, email, fetch, force } = {
                ...this.stepsOptions.checkout,
                ...options,
                ...branch ? {
                    branch
                } : {}
            };
            logger.info('checkout', `Checking out branch ${headBranch}...`);
            this.state.headBranch = headBranch;
            this.state.baseBranch = await this.getBaseBranch();
            if (username) {
                logger.verbose('checkout', `Setting git user.name to "${username}".`);
                if (!dryRun) {
                    await gitClient.setConfig('user.name', username);
                }
            }
            if (email) {
                logger.verbose('checkout', `Setting git user.email to "${email}".`);
                if (!dryRun) {
                    await gitClient.setConfig('user.email', email);
                }
            }
            if (fetch) {
                logger.verbose('checkout', `Fetching all commits and tags from the remote repository...`);
                if (!dryRun) {
                    await gitClient.fetch({
                        prune: true,
                        unshallow: true,
                        tags: true,
                        remote: 'origin',
                        branch: 'HEAD'
                    });
                }
            }
            if (force) {
                logger.verbose('checkout', `Deleting branch ${headBranch} if it exists...`);
                if (!dryRun) {
                    await gitClient.deleteBranch(headBranch).catch(() => null);
                }
            }
            try {
                logger.verbose('checkout', `Creating branch ${headBranch}...`);
                if (!dryRun) {
                    await gitClient.createBranch(headBranch);
                }
            }
            catch {
                logger.verbose('checkout', `Branch ${headBranch} already exists, checking it out...`);
                if (!dryRun) {
                    await gitClient.checkout(headBranch);
                }
            }
        });
    }
    /**
     * Enqueue a task to bump the version of the project.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    bump(options) {
        return this.enqueue(async () => {
            const { project } = this;
            const { dryRun } = this.options;
            const logger = this.logger.createChild('bump');
            logger.info('Bumping version...');
            const done = await project.bump({
                dryRun,
                logger,
                ...this.stepsOptions.bump,
                ...options
            });
            this.state.bump = done;
            if (!done) {
                logger.info('No version changes detected.');
            }
        });
    }
    /**
     * Enqueue a task to commit bump changes to the repository.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    commit(options) {
        return this.enqueue(async () => {
            const { project, logger, gitClient } = this;
            const { dryRun } = this.options;
            logger.info('commit', `Committing changes...`);
            if (!this.state.bump) {
                logger.info('commit', 'No changes to commit.');
                return;
            }
            const files = project.changedFiles;
            const params = {
                ...this.stepsOptions.commit,
                ...options,
                message: project.getCommitMessage(),
                verify: false
            };
            logger.verbose('commit', `Files to commit:`);
            files.forEach((file) => {
                logger.verbose('commit', `- ${file}`);
            });
            logger.verbose('commit', params.message.includes('\n')
                ? `Commit message:\n\n${params.message}\n`
                : `Commit message: ${params.message}`);
            if (!dryRun) {
                await gitClient.add(files);
                await gitClient.commit(params);
            }
        });
    }
    /**
     * Enqueue a task to tag the project with the new version.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    tag(options) {
        return this.enqueue(async () => {
            const { project, logger, gitClient } = this;
            const { dryRun } = this.options;
            logger.info('tag', 'Tagging version...');
            const tags = await project.getTags();
            this.state.tags = tags.length > 0;
            if (!this.state.tags) {
                logger.info('tag', 'No version changes detected.');
                return;
            }
            logger.verbose('tag', `Tags to create:`);
            for (const tag of tags) {
                logger.verbose('tag', `- ${tag}`);
                if (!dryRun) {
                    await gitClient.tag({
                        ...this.stepsOptions.tag,
                        ...options,
                        name: tag
                    });
                }
            }
        });
    }
    /**
     * Enqueue a task to push changes to the remote repository.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    push(options) {
        return this.enqueue(async () => {
            const { logger, gitClient, state } = this;
            const { dryRun } = this.options;
            const branch = await gitClient.getCurrentBranch();
            logger.info('push', `Pushing changes to ${branch}...`);
            if (!state.bump && !state.tags) {
                logger.info('push', 'Nothing to push.');
                return;
            }
            if (!dryRun) {
                if (state.bump) {
                    await gitClient.push(branch, {
                        verify: false,
                        ...this.stepsOptions.push,
                        ...options
                    });
                }
                if (state.tags) {
                    await gitClient.push(branch, {
                        tags: true,
                        verify: false
                    });
                }
            }
        });
    }
    /**
     * Enqueue a task to publish the project.
     * @param options
     * @returns Project releaser instance for chaining.
     */
    publish(options) {
        return this.enqueue(async () => {
            const { project } = this;
            const { dryRun } = this.options;
            const logger = this.logger.createChild('package');
            logger.info('Publishing...');
            await project.publish({
                dryRun,
                logger,
                ...this.stepsOptions.publish,
                ...options
            });
        });
    }
    /**
     * Enqueue a task to create a release.
     * @param option
     * @returns Project releaser instance for chaining.
     */
    release(option) {
        const { hosting } = this;
        if (!hosting) {
            throw new Error('Hosting service is not configured. Please set the hosting option.');
        }
        return this.enqueue(async () => {
            const { project } = this;
            const { dryRun } = this.options;
            const logger = this.logger.createChild('release');
            logger.info('Creating release...');
            await hosting.createRelease({
                project,
                dryRun,
                logger,
                ...this.stepsOptions.release,
                ...option
            });
        });
    }
    /**
     * Enqueue a task to create a pull request.
     * @param option
     * @returns Project releaser instance for chaining.
     */
    pullRequest(option) {
        const { hosting } = this;
        if (!hosting) {
            throw new Error('Hosting service is not configured. Please set the hosting option.');
        }
        return this.enqueue(async () => {
            const { project, state } = this;
            const { dryRun } = this.options;
            const logger = this.logger.createChild('pull-request');
            logger.info('Creating pull request...');
            if (!state.bump) {
                logger.info('No version changes detected, skipping pull request creation.');
                return;
            }
            if (!state.headBranch) {
                logger.info('Head branch is not set, skipping pull request creation.');
                return;
            }
            await hosting.createPullRequest({
                project,
                dryRun,
                logger,
                from: state.headBranch,
                to: await this.getBaseBranch(),
                ...this.stepsOptions.pullRequest,
                ...option
            });
        });
    }
    /**
     * Run all queued tasks in order.
     * @param condition - Optional condition to run the releaser.
     */
    async run(condition) {
        let shouldRun = true;
        if (condition) {
            const { logger } = this;
            logger.info('run', 'Checking condition...');
            shouldRun = await condition(this);
            if (shouldRun) {
                logger.info('run', 'Condition passed, running releas steps...');
            }
            else {
                logger.info('run', 'Condition failed, skipping release steps.');
            }
        }
        if (shouldRun) {
            for (const fn of this.queue) {
                await fn();
            }
        }
        this.queue.length = 0;
        this.logger.info('done', `Done!`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVsZWFzZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcmVsZWFzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQVdwQyxjQUFjLHFCQUFxQixDQUFBO0FBRW5DOztHQUVHO0FBQ0gsTUFBTSxPQUFPLFFBQVE7SUFvQ1Y7SUFoQ1Q7O09BRUc7SUFDTSxPQUFPLENBQUc7SUFDbkI7O09BRUc7SUFDTSxPQUFPLENBQUk7SUFDcEI7O09BRUc7SUFDTSxTQUFTLENBQXVCO0lBQ3pDOztPQUVHO0lBQ00sTUFBTSxDQUFRO0lBQ0osS0FBSyxHQUtwQixFQUFFLENBQUE7SUFFYSxZQUFZLEdBQStCLEVBQUUsQ0FBQTtJQUUvQyxLQUFLLEdBQStCLEVBQUUsQ0FBQTtJQUV2RDs7O09BR0c7SUFDSCxZQUNTLE9BQThCO1FBQTlCLFlBQU8sR0FBUCxPQUFPLENBQXVCO1FBRXJDLE1BQU0sRUFDSixPQUFPLEVBQ1AsT0FBTyxFQUNSLEdBQUcsT0FBTyxDQUFBO1FBRVgsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7UUFDdEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7UUFDdEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFBO1FBQ2xDLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sSUFBSSxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUNyRCxDQUFDO0lBRUQsT0FBTyxDQUFDLEVBQXVCO1FBQzdCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ25CLE9BQU8sSUFBSSxDQUFBO0lBQ2IsQ0FBQztJQUVPLEtBQUssQ0FBQyxhQUFhO1FBQ3pCLE1BQU0sRUFBRSxVQUFVLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRWpDLElBQUksVUFBVSxFQUFF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